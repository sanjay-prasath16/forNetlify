{"version":3,"file":"lib.cjs","sources":["../src/index.ts"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\nimport {\n  Conversation,\n  Mode,\n  SessionConfig,\n  Callbacks,\n  Options,\n  Status,\n  ClientToolsConfig,\n} from \"@11labs/client\";\nexport type { Role, Mode, Status } from \"@11labs/client\";\n\nexport type HookOptions = Partial<\n  SessionConfig & HookCallbacks & ClientToolsConfig\n>;\nexport type HookCallbacks = Pick<\n  Callbacks,\n  | \"onConnect\"\n  | \"onDisconnect\"\n  | \"onError\"\n  | \"onMessage\"\n  | \"onDebug\"\n  | \"onUnhandledClientToolCall\"\n>;\n\nexport function useConversation<T extends HookOptions>(defaultOptions?: T) {\n  const conversationRef = useRef<Conversation | null>(null);\n  const lockRef = useRef<Promise<Conversation> | null>(null);\n  const [status, setStatus] = useState<Status>(\"disconnected\");\n  const [mode, setMode] = useState<Mode>(\"listening\");\n\n  useEffect(() => {\n    return () => {\n      conversationRef.current?.endSession();\n    };\n  }, []);\n\n  return {\n    startSession: (async (options?: HookOptions) => {\n      if (conversationRef.current) {\n        return conversationRef.current.getId();\n      }\n\n      if (lockRef.current) {\n        const conversation = await lockRef.current;\n        return conversation.getId();\n      }\n\n      try {\n        lockRef.current = Conversation.startSession({\n          ...(defaultOptions ?? {}),\n          ...(options ?? {}),\n          onModeChange: ({ mode }) => {\n            setMode(mode);\n          },\n          onStatusChange: ({ status }) => {\n            setStatus(status);\n          },\n        } as Options);\n\n        conversationRef.current = await lockRef.current;\n        return conversationRef.current.getId();\n      } finally {\n        lockRef.current = null;\n      }\n    }) as T extends SessionConfig\n      ? (options?: HookOptions) => Promise<string>\n      : (options: SessionConfig & HookOptions) => Promise<string>,\n    endSession: async () => {\n      const conversation = conversationRef.current;\n      conversationRef.current = null;\n      await conversation?.endSession();\n    },\n    setVolume: ({ volume }: { volume: number }) => {\n      conversationRef.current?.setVolume({ volume });\n    },\n    getInputByteFrequencyData: () => {\n      return conversationRef.current?.getInputByteFrequencyData();\n    },\n    getOutputByteFrequencyData: () => {\n      return conversationRef.current?.getOutputByteFrequencyData();\n    },\n    getInputVolume: () => {\n      return conversationRef.current?.getInputVolume() ?? 0;\n    },\n    getOutputVolume: () => {\n      return conversationRef.current?.getOutputVolume() ?? 0;\n    },\n    status,\n    isSpeaking: mode === \"speaking\",\n  };\n}\n"],"names":["defaultOptions","conversationRef","useRef","lockRef","_useState","useState","status","setStatus","_useState2","mode","setMode","useEffect","_conversationRef$curr","current","endSession","startSession","options","_exit","_temp2","_result","Conversation","_extends","onModeChange","_ref","onStatusChange","_ref2","Promise","resolve","then","_lockRef$current","getId","_finallyRethrows","_wasThrown","_result2","_temp","conversation","_conversation$getId","e","reject","setVolume","_ref3","_conversationRef$curr2","volume","getInputByteFrequencyData","_conversationRef$curr3","getOutputByteFrequencyData","_conversationRef$curr4","getInputVolume","_conversationRef$curr5","_conversationRef$curr6","getOutputVolume","_conversationRef$curr7","_conversationRef$curr8","isSpeaking"],"mappings":"mSAyBgB,SAAuCA,GACrD,IAAMC,EAAkBC,SAA4B,MAC9CC,EAAUD,SAAqC,MACrDE,EAA4BC,EAAQA,SAAS,gBAAtCC,EAAMF,EAAEG,GAAAA,EAASH,KACxBI,EAAwBH,EAAAA,SAAe,aAAhCI,EAAID,EAAEE,GAAAA,EAAOF,EAAA,GAQpB,OANAG,EAAAA,UAAU,WACR,OAAY,WAAA,IAAAC,EACa,OAAvBA,EAAAX,EAAgBY,UAAhBD,EAAyBE,YAC3B,CACF,EAAG,IAEI,CACLC,aAAA,SAAsBC,GAAyB,IAAA,IAyBpBC,EAzBoBC,EAAA,SAAAC,GAAA,OAAAF,EAAAE,2BAW3ChB,EAAQU,QAAUO,EAAAA,aAAaL,aAAYM,KACvB,MAAdrB,EAAAA,EAAkB,SAClBgB,EAAAA,EAAW,CAAE,GACjBM,aAAc,SAAFC,GACVb,EADmBa,EAAJd,KAEjB,EACAe,eAAgB,SAAFC,GACZlB,EADuBkB,EAANnB,OAEnB,KACYoB,QAAAC,QAEkBxB,EAAQU,SAAOe,cAAAC,GAC/C,OADA5B,EAAgBY,QAAOgB,EAChB5B,EAAgBY,QAAQiB,OAAQ,6FAvBIC,CAAA,EAwB5CC,SAAAA,EAAAC,GACwB,GAAvB9B,EAAQU,QAAU,KAAKmB,QAAAC,EAAA,OAAAA,CAAA,EAAA,EAxBzB,GAAIhC,EAAgBY,QAClB,OAAAa,QAAAC,QAAO1B,EAAgBY,QAAQiB,SAChC,IAAAI,EAEG/B,WAAAA,GAAAA,EAAQU,QAAOa,OAAAA,QAAAC,QACUxB,EAAQU,SAAOe,KAApCO,SAAAA,GAAYC,IAAAA,EACXD,EAAaL,QAAO,OAAAb,EAAA,EAAAmB,CAAA,EAAAV,CAFzBvB,GAEyBuB,OAAAA,QAAAC,QAAAO,GAAAA,EAAAN,KAAAM,EAAAN,KAAAV,GAAAA,EAAAgB,GAoB/B,CAAC,MAAAG,GAAA,OAAAX,QAAAY,OAAAD,EAE4D,CAAA,EAC7DvB,WAAU,WAAa,IACrB,IAAMqB,EAAelC,EAAgBY,QACN,OAA/BZ,EAAgBY,QAAU,KAAKa,QAAAC,QACb,MAAZQ,OAAY,EAAZA,EAAcrB,cAAYc,KAAA,WAAA,EAClC,CAAC,MAAAS,GAAA,OAAAX,QAAAY,OAAAD,EACDE,CAAAA,EAAAA,UAAW,SAAFC,GAAqC,IAAAC,SAC5CA,EAAAxC,EAAgBY,UAAhB4B,EAAyBF,UAAU,CAAEG,OADnBF,EAANE,QAEd,EACAC,0BAA2B,WAAKC,IAAAA,EAC9B,OAAOA,OAAPA,EAAO3C,EAAgBY,cAAhB+B,EAAAA,EAAyBD,2BAClC,EACAE,2BAA4B,WAAK,IAAAC,EAC/B,OAAOA,OAAPA,EAAO7C,EAAgBY,cAAhBiC,EAAAA,EAAyBD,4BAClC,EACAE,eAAgB,WAAK,IAAAC,EAAAC,EACnB,OAAgD,OAAhDD,EAAOC,OAAPA,EAAOhD,EAAgBY,cAAhBoC,EAAAA,EAAyBF,kBAAgBC,EAAI,CACtD,EACAE,gBAAiB,WAAKC,IAAAA,EAAAC,EACpB,OAAiDD,OAAjDA,EAA8B,OAA9BC,EAAOnD,EAAgBY,cAAO,EAAvBuC,EAAyBF,mBAAiBC,EAAI,CACvD,EACA7C,OAAAA,EACA+C,WAAqB,aAAT5C,EAEhB"}