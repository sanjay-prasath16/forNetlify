{"version":3,"file":"lib.modern.js","sources":["../src/index.ts"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\nimport {\n  Conversation,\n  Mode,\n  SessionConfig,\n  Callbacks,\n  Options,\n  Status,\n  ClientToolsConfig,\n} from \"@11labs/client\";\nexport type { Role, Mode, Status } from \"@11labs/client\";\n\nexport type HookOptions = Partial<\n  SessionConfig & HookCallbacks & ClientToolsConfig\n>;\nexport type HookCallbacks = Pick<\n  Callbacks,\n  | \"onConnect\"\n  | \"onDisconnect\"\n  | \"onError\"\n  | \"onMessage\"\n  | \"onDebug\"\n  | \"onUnhandledClientToolCall\"\n>;\n\nexport function useConversation<T extends HookOptions>(defaultOptions?: T) {\n  const conversationRef = useRef<Conversation | null>(null);\n  const lockRef = useRef<Promise<Conversation> | null>(null);\n  const [status, setStatus] = useState<Status>(\"disconnected\");\n  const [mode, setMode] = useState<Mode>(\"listening\");\n\n  useEffect(() => {\n    return () => {\n      conversationRef.current?.endSession();\n    };\n  }, []);\n\n  return {\n    startSession: (async (options?: HookOptions) => {\n      if (conversationRef.current) {\n        return conversationRef.current.getId();\n      }\n\n      if (lockRef.current) {\n        const conversation = await lockRef.current;\n        return conversation.getId();\n      }\n\n      try {\n        lockRef.current = Conversation.startSession({\n          ...(defaultOptions ?? {}),\n          ...(options ?? {}),\n          onModeChange: ({ mode }) => {\n            setMode(mode);\n          },\n          onStatusChange: ({ status }) => {\n            setStatus(status);\n          },\n        } as Options);\n\n        conversationRef.current = await lockRef.current;\n        return conversationRef.current.getId();\n      } finally {\n        lockRef.current = null;\n      }\n    }) as T extends SessionConfig\n      ? (options?: HookOptions) => Promise<string>\n      : (options: SessionConfig & HookOptions) => Promise<string>,\n    endSession: async () => {\n      const conversation = conversationRef.current;\n      conversationRef.current = null;\n      await conversation?.endSession();\n    },\n    setVolume: ({ volume }: { volume: number }) => {\n      conversationRef.current?.setVolume({ volume });\n    },\n    getInputByteFrequencyData: () => {\n      return conversationRef.current?.getInputByteFrequencyData();\n    },\n    getOutputByteFrequencyData: () => {\n      return conversationRef.current?.getOutputByteFrequencyData();\n    },\n    getInputVolume: () => {\n      return conversationRef.current?.getInputVolume() ?? 0;\n    },\n    getOutputVolume: () => {\n      return conversationRef.current?.getOutputVolume() ?? 0;\n    },\n    status,\n    isSpeaking: mode === \"speaking\",\n  };\n}\n"],"names":["useConversation","defaultOptions","conversationRef","useRef","lockRef","status","setStatus","useState","mode","setMode","useEffect","_conversationRef$curr","current","endSession","startSession","async","getId","Conversation","_extends","options","onModeChange","onStatusChange","conversation","setVolume","volume","_conversationRef$curr2","getInputByteFrequencyData","_conversationRef$curr3","getOutputByteFrequencyData","_conversationRef$curr4","getInputVolume","_conversationRef$curr5","_conversationRef$curr6","getOutputVolume","_conversationRef$curr7","_conversationRef$curr8","isSpeaking"],"mappings":"kUAyBgB,SAAAA,EAAuCC,GACrD,MAAMC,EAAkBC,EAA4B,MAC9CC,EAAUD,EAAqC,OAC9CE,EAAQC,GAAaC,EAAiB,iBACtCC,EAAMC,GAAWF,EAAe,aAQvC,OANAG,EAAU,IACD,KAAKC,IAAAA,EACVA,OAAAA,EAAAT,EAAgBU,UAAhBD,EAAyBE,YAC3B,EACC,IAEI,CACLC,aAAeC,UACb,GAAIb,EAAgBU,QAClB,OAAOV,EAAgBU,QAAQI,QAGjC,GAAIZ,EAAQQ,QAEV,aAD2BR,EAAQQ,SACfI,QAGtB,IAaE,OAZAZ,EAAQQ,QAAUK,EAAaH,aAAYI,EAAA,CAAA,EACrCjB,MAAAA,EAAAA,EAAkB,GACX,MAAPkB,EAAAA,EAAW,CAAA,EACfC,CAAAA,aAAcA,EAAGZ,WACfC,EAAQD,IAEVa,eAAgBA,EAAGhB,aACjBC,EAAUD,EACZ,KAGFH,EAAgBU,cAAgBR,EAAQQ,QACjCV,EAAgBU,QAAQI,OACjC,CAAC,QACCZ,EAAQQ,QAAU,IACpB,GAIFC,WAAYE,UACV,MAAMO,EAAepB,EAAgBU,QACrCV,EAAgBU,QAAU,iBACpBU,SAAAA,EAAcT,eAEtBU,UAAWA,EAAGC,aAAgCC,IAAAA,EAC5CA,OAAAA,EAAAvB,EAAgBU,UAAhBa,EAAyBF,UAAU,CAAEC,UAAQ,EAE/CE,0BAA2BA,KAAKC,IAAAA,EAC9B,cAAAA,EAAOzB,EAAgBU,gBAAhBe,EAAyBD,2BAAyB,EAE3DE,2BAA4BA,SAAKC,EAC/B,cAAAA,EAAO3B,EAAgBU,gBAAhBiB,EAAyBD,8BAElCE,eAAgBA,SAAKC,EAAAC,EACnB,cAAAD,SAAAC,EAAO9B,EAAgBU,gBAAhBoB,EAAyBF,kBAAgBC,EAAI,GAEtDE,gBAAiBA,KAAKC,IAAAA,EAAAC,EACpB,OAAiDD,OAAjDA,EAAOC,OAAPA,EAAOjC,EAAgBU,cAAhBuB,EAAAA,EAAyBF,mBAAiBC,EAAI,GAEvD7B,SACA+B,WAAqB,aAAT5B,EAEhB"}